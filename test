<template>
    <div class="row g-2 mb-2">
      <div class="col-sm-6 col-xl-4">
        <div class="card" style="height: 79px;">
          <div class="card-body">
            <div class="d-flex align-items-start justify-content-between">
              <div class="content-left" style=" margin-top: -11px;" >
                <span> القوانين</span>
                <div class="d-flex align-items-center my-1">
                  <h4 class="mb-0 me-2">{{ lawsCount }}</h4>
                 </div>
              </div>
              <span class="badge bg-label-primary rounded p-2">
                <i class="ti ti-book ti-sm"></i>
              </span>
            </div>
          </div>
        </div> 
      </div>
      <div class="col-sm-6 col-xl-4">
        <div class="card" style="height: 79px;">
          <div class="card-body">
            <div class="d-flex align-items-start justify-content-between">
              <div class="content-left" style=" margin-top: -11px;">
                <span> اللوائح</span>
                <div class="d-flex align-items-center my-1">
                  <h4 class="mb-0 me-2">{{ regulationsCount }}</h4>
                 </div>
              </div>
              <span class="badge bg-label-primary rounded p-2">
                <i class="ti ti-book ti-sm"></i>
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-xl-4">
        <div class="card" style="height: 79px;">
          <div class="card-body">
            <div class="d-flex align-items-start justify-content-between">
              <div class="content-left" style=" margin-top: -11px;">
                <span> التعميمات</span>
                <div class="d-flex align-items-center my-1">
                  <h4 class="mb-0 me-2">{{ circularsCount }}</h4>
                 </div>
              </div>
              <span class="badge bg-label-primary rounded p-2">
                <i class="ti ti-book ti-sm"></i>
              </span>
            </div>
          </div>
        </div>
      </div>
     
      <transition name="fade">
          <div v-if="alertMessage" class="alert"> {{ alertMessage }}</div>
        </transition>
          </div>
        
   
  
    <!-------------------------------------------------------------- بحث المستخدمين  -->
  
<div class="card" style="border: 2px solid; border-color: #82c5ff; box-shadow: none">
      <h5 class="card-header clickable" @click="toggleShowHide"    style="background-color: rgb(48 52 90); color: wheat; padding: 10px;">
        <i class="fa fa-add" style=" margin-left: 4px;"></i>اضافة عنصر جديد للمكتبة 
      </h5>
<div class="card-body" >
        <div v-if="showAdd"   class="row">
          <div class="row" style="margin-top: 11px;">
          <div class="col-12 col-md-3">
            <label class="form-label" 
            for="modalEditUserLastName" style="color: rgb(1, 1, 1)">الاسم   
            </label>
            <input v-model="name" type="text"  class="form-control">
            <p v-if="errors.name" class="error" >{{ errors.name }}</p>
          </div>        
          <div class="col-md-3">
            <label style="color: rgb(1, 1, 1)">النوع</label>
            <select ref="typeSelect" v-model="type"  class="select2 form-select" data-allow-clear="true" >
              <option selected></option>
              <option  v-for="(option,index) in typeOptions" :key="index" :value="option.CONST_ID">
                {{ option.CONST_NAME }}
              </option> 
         
            </select>
            <p v-if="errors.type" class="error" >{{ errors.type }}</p>

          </div>
          <div class="col-md-3">
            <label style="color: rgb(1, 1, 1)">المصدر</label>
            <select ref="sourceSelect" v-model="source" class="select2 form-select" data-allow-clear="true" >
              <option selected></option>
              <option  v-for="(option,index) in sourceOptions" :key="index" :value="option.CONST_ID">
                {{ option.CONST_NAME }}
              </option> 
            </select>
            <p v-if="errors.source" class="error" >{{ errors.source }}</p>

          </div>
          <div class="col-md-3">
            <label style="color: rgb(1, 1, 1)">الحالة</label>
            <select ref="statusSelect"  v-model="status" class="select2 form-select" data-allow-clear="true" >
               <option  v-for="(option,index) in statusOptions" :key="index" :value="option.CONST_ID">
                {{ option.CONST_NAME }}
              </option> 
            </select>
            <p v-if="errors.status" class="error" >{{ errors.status }}</p>

          </div> 
          <div class="col-12 col-md-3">
                        <label for="flatpickr-date" class="form-label" style="color: rgb(1, 1, 1)"> تاريخ الاصدار</label>
                          <input v-model="issueDate" type="date"   class="form-control" >
                          <p v-if="errors.issueDate" class="error" >{{ errors.issueDate }}</p>

            </div>
 
          <div class="col-12 col-md-3">
                    <label for="flatpickr-date" class="form-label" style="color: rgb(1, 1, 1)"> تاريخ التعديل</label>
                      <input v-model="modificationDate" type="date"   class="form-control" >
                      <p v-if="errors.modificationDate" class="error" >{{ errors.modificationDate }}</p>

            </div> 
          <div class="col-md-6">
            <label style="color: rgb(1, 1, 1)">  الملاحظات</label>
            <textarea v-model="note" class="form-control"   rows="1" ></textarea>
          </div>
          
        </div>
        
        <br>
        <br>
        <div class="row d-flex justify-content-center">
          <div class="col-md-1">
            <button type="submit" @click="submitForm" class="btn btn-primary waves-effect waves-light">
              <i class="fa fa-plus"></i>
              اضافة
            </button>
          </div>
  
          <div class="col-md-1">
            <button type="button" class="btn btn-info waves-effect waves-light">
              <i class="fa fa-search"></i>
              بحث
            </button>
          </div> <div class="col-md-1">
            <button type="button" class="btn btn-danger waves-effect waves-light">
              <i class="fa fa-eraser"></i>
              تفريغ
            </button>
          </div>
        </div>
    
        </div>
      </div>
</div>
<!-- end of add form -->

   <div class="card" style="border: 2px solid; border-color: #82c5ff; box-shadow: none">
      <h5 class="card-header clickable" @click="toggleShowHide"    style="background-color: rgb(48 52 90); color: wheat; padding: 10px;">
        <i class="fa fa-search" style=" margin-left: 4px;"></i>    ابحث في المكتبة   
      </h5>
<div class="card-body" >
        <div v-if="showSearch"   class="row">
          <div class="row" style="margin-top: 11px;">
          <div  class="col-12 col-md-3">
            <label class="form-label"  for="modalEditUserLastName" style="color: rgb(1, 1, 1)">الاسم   
            </label>
            <input  v-model="searchTerm" type="text" @input="search"  class="form-control">
            <p v-if="errors.name" class="error" >{{ errors.name }}</p>
          </div>        
          <div class="col-md-3">
            <label style="color: rgb(1, 1, 1)">النوع</label>
            <select ref="typeSelect"  class="select2 form-select" data-allow-clear="true" >
              <option selected></option>
              <option  v-for="(option,index) in typeOptions" :key="index" :value="option.CONST_ID">
                {{ option.CONST_NAME }}
              </option> 
         
            </select>
            <p v-if="errors.type" class="error" >{{ errors.type }}</p>

          </div>
          <div class="col-md-3">
            <label style="color: rgb(1, 1, 1)">المصدر</label>
            <select ref="sourceSelect"  v-model="searchTerm"  class="select2 form-select" data-allow-clear="true" >
              <option selected></option>
              <option  v-for="(option,index) in sourceOptions" :key="index" :value="option.CONST_ID">
                {{ option.CONST_NAME }}
              </option> 
            </select>
            <p v-if="errors.source" class="error" >{{ errors.source }}</p>

          </div>
          <div class="col-md-3">
            <label style="color: rgb(1, 1, 1)">الحالة</label>
            <select ref="statusSelect"    class="select2 form-select" data-allow-clear="true" >
               <option  v-for="(option,index) in statusOptions" :key="index" :value="option.CONST_ID">
                {{ option.CONST_NAME }}
              </option> 
            </select>
            <p v-if="errors.status" class="error" >{{ errors.status }}</p>

          </div> 
       
 
       
          
        </div>
        
        <br>
        <br>
        <div class="row d-flex justify-content-center">
         
  
          <div class="col-md-1">
            <button type="button" class="btn btn-info waves-effect waves-light">
              <i class="fa fa-search"></i>
              بحث
            </button>
          </div> 
          
           
        </div>
    
        </div>
      </div>
    </div>
   <!-- end of search form  -->
    <div class="card" style="border: 2px solid; border-color: #82c5ff; box-shadow: none">
      <h5 class="card-header" style="background-color: rgb(48 52 90); color: wheat ; padding: 10px;" > عرض البحث :</h5>
  
      <div class="table-responsive text-nowrap">
        <div v-if="error">
            <p>{{ error.message }}</p>
        </div>
        <table v-else class="table">
          <thead class="table-">
            <tr>
              
              <th>  العنوان</th>
              <th>تاريخ الاصدار</th>
              <th>تاريخ التعديل</th>
              <th>الحالة</th>
              <th>المصدر</th>
              <th>التفاصيل</th>
              <th>إجراء</th>
            </tr>
          </thead>
          <tbody class="table-border-bottom-0">
            <tr v-for="(decision, index) in searchResults" :key="index">
              <td>  <strong>{{ decision.LIBER_NM }}</strong></td>
              <td>{{ formatDate(decision.RELEASE_DATE) }}</td>
              <td>{{ formatDate(decision.MODIFIED_DATE) }}</td>
              <td>
              {{ decision.STATUS_NAME }}
              </td>
              <td> 
                {{ decision.SOURCE_NAME }}
              </td>
              <td>
                {{ decision.NOTE }}
              </td>

              <td>
<button class="btn btn-sm btn-danger" @click="deleteDecision(decision.LIBER_NO)">حذف</button>
              </td>
            </tr>
          
          </tbody>
        </table>
      </div>
      
     
      
    </div>
   <!-- end of table -->
  </template>
